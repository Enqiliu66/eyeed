name: è‡ªåŠ¨åŒæ­¥åˆ°Gitee & éƒ¨ç½²Pages
on:
  push:
    branches: [main]  # ä»…åŒæ­¥mainåˆ†æ”¯
  schedule:
    - cron: '0 8 * * *'  # æ¯å¤©åŒ—äº¬æ—¶é—´8:00å¼ºåˆ¶åŒæ­¥

jobs:
  sync-to-gitee:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: é…ç½®Giteeè¿œç¨‹ä»“åº“
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          # å¼•ç”¨Secretä¸­çš„Giteeç”¨æˆ·åï¼Œè€Œéç¡¬ç¼–ç 
          git remote add gitee https://${{ secrets.GITEE_USER }}:${{ secrets.GITEE_TOKEN }}@gitee.com/${{ secrets.GITEE_USER }}/${{ github.repository_name }}
          git push -f gitee main
        env:
          # ä»Secretä¸­è·å–ç”¨æˆ·åï¼Œä¸å†ç¡¬ç¼–ç 
          GITEE_USER: ${{ secrets.GITEE_USER }}
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}

  deploy-gitee-pages:
    needs: sync-to-gitee
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºGiteeä»£ç 
        uses: actions/checkout@v4
        with:
          repository: ${{ secrets.GITEE_USER }}/${{ github.repository_name }}
          ref: main
          token: ${{ secrets.GITEE_TOKEN }}

      - name: éƒ¨ç½²Gitee Pages
        uses: yanglbme/gitee-pages-action@v4
        with:
          gitee-repo: ${{ secrets.GITEE_USER }}/${{ github.repository_name }}
          branch: main
          commit-message: "ğŸ“¦ è‡ªåŠ¨éƒ¨ç½²Pages [ci skip]"
